<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Fits the Bradley-Terry model — btfit • BradleyTerryScalable</title>

<!-- jquery -->
<script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">


<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script>
<script src="../pkgdown.js"></script>
  
  
<!-- mathjax -->
<script src='https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">BradleyTerryScalable</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/index.html">Articles</a>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/EllaKaye/BradleyTerryScalable">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

      <div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Fits the Bradley-Terry model</h1>
    </div>

    
    <p><code>btfit</code> fits the Bradley-Terry model on (potentially) large and sparse datasets.</p>
    

    <pre class="usage"><span class='fu'>btfit</span>(<span class='no'>btdata</span>, <span class='no'>a</span>, <span class='kw'>MAP_by_component</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>subset</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>maxit</span> <span class='kw'>=</span> <span class='fl'>10000</span>,
  <span class='kw'>epsilon</span> <span class='kw'>=</span> <span class='fl'>0.001</span>)</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a> Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>btdata</th>
      <td><p>A <code><a href='btdata.html'>btdata</a></code> object</p></td>
    </tr>
    <tr>
      <th>a</th>
      <td><p>Must be &gt;= 1. When <code>a = 1</code>, the function returns the MLE estimate of \(pi\) (by component, if necessary). When <code>a &gt; 1</code>, <code>a</code> is the shape parameter for the Gamma prior (See Details).</p></td>
    </tr>
    <tr>
      <th>MAP_by_component</th>
      <td><p>Logical. Only considered if a &gt; 1. Then, if FALSE, the MAP estimate will be found on the full dataset. If TRUE, the MAP estimate will be found separately for each fully-connected component.</p></td>
    </tr>
    <tr>
      <th>subset</th>
      <td><p>A condition for selecting a subset of the components. This can either be a character vector of names of the components, a single predicate function (that takes a component as its argument), or a logical vector of the same length as the number of components).</p></td>
    </tr>
    <tr>
      <th>maxit</th>
      <td><p>The maximum number of iterations for the algorithm. If returning <code>pi</code> by component, this will be the maximum number of iterations for each component.</p></td>
    </tr>
    <tr>
      <th>epsilon</th>
      <td><p>Determines when the algorithm is deemed to have converged. (See Details.)</p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p><code>btfit</code> returns an S3 object of class <code>"btfit"</code>. It is a list containing the following components:</p>
<dt>call</dt><dd><p>The matched call</p></dd>
<dt>pi</dt><dd><p>A list of length \(M\), where \(M\) is the number of fully-connected components of \(G_W\) (or the requested subset) of two or more items. The \(m\)-th item is a vector \(\pi\), the strength parameter, for the items in the \(m\)-th fully connected component, \(m = 1, \ldots, M\). These are sorted in descending order.</p></dd>
<dt>iters</dt><dd><p>A vector of length \(M\). The \(m\)-th entry is the number of iterations it took for the algorithm to converge for the \(m\)-th component, for \(m = 1, \ldots, M\). Note that if the algorithm has not converged in any component, a warning will be produced.</p></dd>
<dt>converged</dt><dd><p>A logical vector of length \(M\), indicating whether the algorithm has converged for the \(m\)-th component in <code>maxit</code> iterations.</p></dd>
<dt>N</dt><dd><p>A list of length \(M\). The \(m\)-th item is a matrix where each element \(n_{ij}\) is the number of times item \(i\) played against item \(j\), for the items in the \(m\)-th component. The rows and columns are arranged in the same order as the ordered pi vector(s).</p></dd>
<dt>diagonal</dt><dd><p>A list of length \(M\). The \(m\)-th item is a vector of the diagonal elements of the <code>btdata$wins</code> matrix, for the items in the \(m\)-th fully-connected component</p></dd>
<dt>names_dimnames</dt><dd><p>The names of the dimnames of the original <code>btdata$wins</code> matrix.</p></dd>

    
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>Let there be \(K\) items, let \(\pi_k\) be the Bradley-Terry strength parameter of item \(k\), for \(k = 1, \ldots, K\) and let \(\pi\) be the vector of all the \(\pi_k\). Let \(w_{ij}\) be the number of times item \(i\) wins against item \(j\), let \(n_{ij} = w_{ij} + w_{ji}\) be the number of times they play, with \(w_{ii} = 0\) by convention and let \(W_i = \sum_{j=1}^K w_{ij}\). Then the Bradley-Terry model states that the probability of item \(i\) beating item \(j\), \(p_{ij}\), is:
    $$p_{ij} = \frac{\pi_i}{\pi_i + \pi_j}.$$</p>
<p>The comparison graph, \(G_W\), has the \(K\) players as the nodes and a directed edge from node \(i\) to node \(j\) whenever item \(i\) has beaten item \(j\) at least once. The MLE of the Bradley-Terry model exists and is finite if and only if the comparison graph is fully-connected (i.e. if there is a directed path from node \(i\) to node \(j\) for all items \(i\) and \(j\)).</p>
<p>Assuming that the comparison graph of the data is fully-connected, the MLE of the Bradley-Terry model can be found using the MM-algorithm (Hunter, 2004).</p>
<p>If the comparison graph of the data is not fully-connected, there are two principled options for fitting the Bradley-Terry model. One is to find the MLE within each fully-connected component. The other is to find the Bayesian MAP estimate, as suggested by Caron &amp; Doucet (2012), where a \(Gamma(a,b)\)  gamma prior is placed on each \(\pi_i\), and the product of these is taken as a prior on \(\pi\). The MAP estimate can then be found with an EM-algorithm. When \(a = 1\) and \(b = 0\), the EM and MM-algorithms are equivalent and the MAP estimate and MLE are identical. The rate parameter of the Gamma prior, \(b\), is not likelihood identifiable. When \(a &gt; 1\), \(b\) is set to \(a *K - 1\), where K is the number of items in the component; this minimises the number of iterations needed for the algorithm to converge.</p>
<p>The likelihood equations give
    $$a - 1 + W_i = b\pi_i + \sum_{j \neq i} \frac{n_{ij}\pi_i}{\pi_i + \pi_j},$$</p>
<p>for \(i = 1, \ldots, K\). For the algorithm to have converged, we \(\pi\) to be such that the LHS and RHS of this equation are close for all \(i\). Therefore, we set the convergence criteria as
    $$\left|\frac{a - 1 + W_i}{b\pi_i + \sum_{j \neq i} \frac{n_{ij}\pi_i}{\pi_i + \pi_j}} - 1\right| &lt; \epsilon,$$</p>
<p>for all \(i\).</p>
    
    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p>Caron, F. and Doucet, A. (2012) Efficient Bayesian Inference for Generalized Bradley-Terry Models. <em>Journal of Computational and Graphical Statistics</em>, <strong>21</strong>(1), 174-196.</p>
<p>Hunter, D. R. (2004) MM Algorithms for Generalized Bradley-Terry Models. <em>The Annals of Statistics</em>, <strong>32</strong>(1), 384-406.</p>
    
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <p><code><a href='btdata.html'>btdata</a></code>, <code><a href='summary.btfit.html'>summary.btfit</a></code>, <code><a href='coef.btfit.html'>coef.btfit</a></code>, <code><a href='vcov.btfit.html'>vcov.btfit</a></code>, <code><a href='simulate_BT.html'>simulate.btfit</a></code></p>
    

  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#value">Value</a></li>

      <li><a href="#details">Details</a></li>

      <li><a href="#references">References</a></li>

      <li><a href="#see-also">See also</a></li>
          </ul>

  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by Ella Kaye, David Firth.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
   </div>

  </body>
</html>
